class EsportsNotifier{constructor(e){this.config=e,this.VERSION="0.0.1",this.APPNAME="esports-notifier",this.GITHUB_REPOSITORY="lucasvtiradentes/esports-notifier",this.TODAY_DATE=(new Date).toISOString().split("T")[0],this.ENVIRONMENT=this.detectEnvironment(),this.APPS_SCRIPTS_PROPERTIES={todayTicktickAddedTasks:"todayTicktickAddedTasks",todayTicktickUpdateTasks:"todayTicktickUpdateTasks",todayTicktickCompletedTasks:"todayTicktickCompletedTasks",todayGithubAddedCommits:"todayGithubAddedCommits",todayGithubDeletedCommits:"todayGithubDeletedCommits",lastReleasedVersionAlerted:"lastReleasedVersionAlerted"},this.ERRORS={mustSpecifyConfig:"You must specify the settings when starting the class"},this.validateConfigs(e),this.config=e}validateConfigs(e){if(!e)throw new Error(this.ERRORS.mustSpecifyConfig);[{objToCheck:e,requiredKeys:["timeToSendEmail","diffHoursFromUtc","favoriteTeams","strictComparasion","games"],name:"configs"},{objToCheck:e.games,requiredKeys:["csgo","valorant","rainbowSixSiege","dota","lol","rocketLeague","overwatch","callOfDuty","freeFire"],name:"configs.games"}].forEach((e=>{const{objToCheck:t,requiredKeys:i,name:r}=e;i.forEach((e=>{if(!t||!Object.keys(t).includes(e))throw new Error(`missing key in ${r}: ${e}`)}))}))}logger(e){console.log(e)}detectEnvironment(){return"undefined"==typeof Calendar?"development":"production"}check(){const e=[...this.getCsgoMatches(),...this.getR6Matches(),...this.getValorantMatches()],t=e.filter((e=>e.teams.some((e=>this.config.favoriteTeams.includes(e.toLowerCase())))));console.log(t),console.log(e.length),console.log(t.length)}parseHtmlData(e){return globalThis.Cheerio.load(e)}getCsgoMatches(){const e="https://liquipedia.net",t=`${e}/counterstrike/Main_Page`,i=UrlFetchApp.fetch(t,{muteHttpExceptions:!0}).getContentText(),r=this.parseHtmlData(i)("table.infobox_matches_content"),n=e=>{var t,i;const r=e.children.find((e=>{var t;return(null===(t=e.attribs)||void 0===t?void 0:t.class.search("team-template-text"))>-1}));return null===(i=null===(t=null==r?void 0:r.children[0])||void 0===t?void 0:t.children[0])||void 0===i?void 0:i.data},a=e=>{var t,i,r;const n=e.children.find((e=>{var t;return(null===(t=e.attribs)||void 0===t?void 0:t.class.search("team-template-image-icon"))>-1}));return null===(r=null===(i=null===(t=null==n?void 0:n.children[0])||void 0===t?void 0:t.children[0])||void 0===i?void 0:i.attribs)||void 0===r?void 0:r.src};return Array.from(r).map((t=>{const i=t.children[1].children[2].children[1].children[0].children[0].children[0].data,r=t.children[1].children[0].children[1].children[0],c=t.children[1].children[0].children[5].children[0],l=i.split(" - ")[0],d=i.split(" - ")[1],s=t.children[1].children[2].children[1].children[1].children[0].children[0].children[0].data,h=n(r),o=a(r),m=n(c),g=a(c);return{game:"csgo",teamA:{name:h,image:`${e}${o}`,countryImage:""},teamB:{name:m,image:`${e}${g}`,countryImage:""},teams:[h,m],date:l,time:d,event:s,link:`${e}`}}))}getR6Matches(){const e="https://siege.gg",t=`${e}/matches`,i=UrlFetchApp.fetch(t,{muteHttpExceptions:!0}).getContentText(),r=this.parseHtmlData(i)("a.match--awaiting-results");return Array.from(r).map((t=>{const i=t.children[0].children[0].children[0].data,r=t.children[0].children[1].children[0].data,n=t.children[0].children[2].children[0].data,a=t.attribs.href,c=t.children[1].children[0].children[0].children[2].children[0].data.trim(),l=t.children[1].children[0].children[0].children[0].attribs.src,d=t.children[1].children[0].children[0].children[1].children[0].attribs.src,s=t.children[1].children[2].children[0].children[2].children[0].data.trim();return{game:"rainbowSixSiege",teamA:{name:c,image:l,countryImage:d},teamB:{name:s,image:t.children[1].children[2].children[0].children[0].attribs.src,countryImage:t.children[1].children[2].children[0].children[1].children[0].attribs.src},teams:[c,s],date:i,time:r,event:n,link:`${e}${a}`}}))}getValorantMatches(){const e=UrlFetchApp.fetch("https://www.vlr.gg/matches").getContentText(),t=this.parseHtmlData(e)("a.match-item");return Array.from(t).map((e=>{const t=e.parent.prev.prev.children[0].data.trim(),i=e.children[0].next.children[0].data.trim(),r=e.children[13].children[2].data.trim(),n=e.children[3].children[1].children[1].children[1].children[2].data.trim(),a=e.children[3].children[1].children[1].children[1].children[1].attribs.class.replace("flag ",""),c=e.children[3].children[3].children[1].children[1].children[2].data.trim();return{game:"valorant",teamA:{name:n,image:"",countryImage:a},teamB:{name:c,image:"",countryImage:e.children[3].children[3].children[1].children[1].children[1].attribs.class.replace("flag ","")},teams:[n,c],date:t,time:i,event:r,link:e.attribs.href}}))}}