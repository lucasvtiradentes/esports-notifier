!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).EsportsNotifier=t()}(this,(function(){"use strict";return class{constructor(e){this.config=e,this.VERSION="1.1.0",this.APPNAME="esports notifier",this.GITHUB_REPOSITORY="lucasvtiradentes/esports-notifier",this.TODAY_DATE="",this.SESSION_LOGS=[],this.ENVIRONMENT=this.detectEnvironment(),this.USER_EMAIL="production"===this.ENVIRONMENT?this.getUserEmail():"",this.ERRORS={mustSpecifyConfig:"You must specify the settings when starting the class",timeToSendEmailIncorrect:"You must specify a correct time string in config.datetime.timeToSendEmail, such as: 07:00"},this.todayMatches=[],this.todayFavoriteTeamsMatches=[],this.validateConfigs(e),this.config=e,this.TODAY_DATE=this.getDateFixedByTimezone(new Date,this.config.datetime.diffHoursFromGmtTimezone).toISOString().split("T")[0],this.logger(`${this.APPNAME} is running at version ${this.VERSION} in ${this.ENVIRONMENT} environment`),this.logger(`check the docs for your version here: https://github.com/${this.GITHUB_REPOSITORY}/tree/v${this.VERSION}#readme`)}validateConfigs(e){var t;if(!e)throw new Error(this.ERRORS.mustSpecifyConfig);[{objToCheck:e,requiredKeys:["esports","datetime","settings"],name:"configs"},{objToCheck:null==e?void 0:e.esports,requiredKeys:["favoriteTeams","games"],name:"configs.esports"},{objToCheck:null===(t=null==e?void 0:e.esports)||void 0===t?void 0:t.games,requiredKeys:["csgo","valorant","rainbowSixSiege","leagueOfLegends"],name:"configs.esports.games"},{objToCheck:null==e?void 0:e.datetime,requiredKeys:["diffHoursFromGmtTimezone","timeToSendEmail"],name:"configs.datetime"},{objToCheck:null==e?void 0:e.settings,requiredKeys:["notifyOnlyAboutTodayGames","strictTeamComparasion","maintanceMode","loopFunction"],name:"configs.settings"}].forEach((e=>{const{objToCheck:t,requiredKeys:i,name:s}=e;i.forEach((e=>{if(!t||!Object.keys(t).includes(e))throw new Error(`missing key in ${s}: ${e}`)}))}))}detectEnvironment(){return"undefined"==typeof UrlFetchApp?"development":"production"}logger(e,t){this.SESSION_LOGS.push(e),"before"===t&&console.log(""),console.log(e),"after"===t&&console.log("")}getDateFixedByTimezone(e,t){return e.setHours(e.getHours()+t),e}parseHtmlData(e){return globalThis.Cheerio.load(e)}getUserEmail(){return"production"===this.ENVIRONMENT?Session.getActiveUser().getEmail():""}getPageContent(e){return"production"===this.ENVIRONMENT?UrlFetchApp.fetch(e,{muteHttpExceptions:!0}).getContentText():""}getGamesFromLiquipedia(e){const t="https://liquipedia.net",i=`${t}/${e.pathUrl}`,s=this.getPageContent(i),a=this.parseHtmlData(s)("table.infobox_matches_content"),n=e=>{var t,i;const s=e.children.find((e=>{var t;return(null===(t=e.attribs)||void 0===t?void 0:t.class.search("team-template-text"))>-1}));return null===(i=null===(t=null==s?void 0:s.children[0])||void 0===t?void 0:t.children[0])||void 0===i?void 0:i.data},o=e=>{var t,i,s;const a=e.children.find((e=>{var t;return(null===(t=e.attribs)||void 0===t?void 0:t.class.search("team-template-image-icon"))>-1}));return null===(s=null===(i=null===(t=null==a?void 0:a.children[0])||void 0===t?void 0:t.children[0])||void 0===i?void 0:i.attribs)||void 0===s?void 0:s.src};return Array.from(a).filter((e=>"1"===e.parent.attribs["data-toggle-area-content"])).map((s=>{const a=this.getDateFixedByTimezone(new Date(s.children[1].children[2].children[1].children[0].children[0].children[0].data.replace("- ","")),this.config.datetime.diffHoursFromGmtTimezone).toISOString(),r=s.children[1].children[0].children[1].children[0],g=s.children[1].children[0].children[5].children[0],h=a.split("T")[0],l=a.split("T")[1].slice(0,5),c=s.children[1].children[2].children[1].children[1].children[0].children[0].children[0].data,m=n(r),d=o(r),p=n(g),u=o(g);return{game:{name:e.gameName,image:e.gameImage,link:i},teamA:{name:m,image:`${t}${d}`,countryImage:""},teamB:{name:p,image:`${t}${u}`,countryImage:""},teams:[m,p],date:h,time:l,event:c,link:""}}))}getCallOfDutyMatches(){const e=this.getGamesFromLiquipedia({gameName:"callOfDuty",gameImage:"https://profile.callofduty.com/resources/cod/images/shared-logo.jpg",pathUrl:"callofduty/Liquipedia:Upcoming_and_ongoing_matches"});return this.logger(`found ${e.length} cod matches`),e}getDotaMatches(){const e=this.getGamesFromLiquipedia({gameName:"dota",gameImage:"https://seeklogo.com/images/D/dota-2-logo-C88DABB066-seeklogo.com.png",pathUrl:"dota2/Liquipedia:Upcoming_and_ongoing_matches"});return this.logger(`found ${e.length} dota matches`),e}getRocketLeagueMatches(){const e=this.getGamesFromLiquipedia({gameName:"rocketLeague",gameImage:"https://upload.wikimedia.org/wikipedia/he/thumb/6/68/Rocket_league_logo_1.jpeg/675px-Rocket_league_logo_1.jpeg?20210526204716",pathUrl:"rocketleague/Liquipedia:Matches"});return this.logger(`found ${e.length} rocketLeague matches`),e}getOverwatchMatches(){const e=this.getGamesFromLiquipedia({gameName:"overwatch",gameImage:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Overwatch_circle_logo.svg/600px-Overwatch_circle_logo.svg.png?20160426111034",pathUrl:"overwatch/Liquipedia:Upcoming_and_ongoing_matches"});return this.logger(`found ${e.length} overwatch matches`),e}getLolMatches(){const e=this.getGamesFromLiquipedia({gameName:"leagueOfLegends",gameImage:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/LoL_icon.svg/256px-LoL_icon.svg.png?20201029024159",pathUrl:"leagueoflegends/Liquipedia:Matches"});return this.logger(`found ${e.length} lol matches`),e}getCsgoMatches(){const e=this.getGamesFromLiquipedia({gameName:"csgo",gameImage:"https://seeklogo.com/images/C/counter-strike-global-offensive-logo-CFCEFBBCE2-seeklogo.com.png",pathUrl:"counterstrike/Liquipedia:Matches"});return this.logger(`found ${e.length} csgo matches`),e}getR6Matches(){const e=this.getGamesFromLiquipedia({gameName:"rainbowSixSiege",gameImage:"https://www.clipartmax.com/png/small/308-3080527_0-tom-clancys-rainbow-six-siege.png",pathUrl:"rainbowsix/Liquipedia:Upcoming_and_ongoing_matches"});return this.logger(`found ${e.length} r6 matches`),e}getValorantMatches(){const e="https://www.vlr.gg",t=`${e}/matches`,i=this.getPageContent(t),s=this.parseHtmlData(i)("a.match-item"),a=Array.from(s).map((i=>{const s=new Date(i.parent.prev.prev.children[0].data.trim()).toISOString().split("T")[0],a=(e=>{const[t,i]=e.split(" "),s=t.split(":"),a=`${("AM"===i?Number(s[0]):Number(s[0])+12)+2}:${s[1]}`;return 4===a.length?`0${a}`:a})(i.children[0].next.children[0].data.trim()),n=i.children[13].children[2].data.trim(),o=i.children[3].children[1].children[1].children[1].children[2].data.trim(),r=i.children[3].children[1].children[1].children[1].children[1].attribs.class.replace("flag ",""),g=i.children[3].children[3].children[1].children[1].children[2].data.trim(),h=i.children[3].children[3].children[1].children[1].children[1].attribs.class.replace("flag ","");return{game:{name:"valorant",image:"https://seeklogo.com/images/V/valorant-logo-FAB2CA0E55-seeklogo.com.png",link:t},teamA:{name:o,image:"",countryImage:`${e}/img/icons/flags/16/${r.replace("mod-","")}.png`},teamB:{name:g,image:"",countryImage:`${e}/img/icons/flags/16/${h.replace("mod-","")}.png`},teams:[o,g],date:s,time:a,event:n,link:`${e}${i.attribs.href}`}}));return this.logger(`found ${a.length} valorant matches`),a}sortGamesByDatetime(e){return e.sort(((e,t)=>Number(new Date(`${e.date}T${e.time}`))-Number(new Date(`${t.date}T${t.time}`))))}getAllTodayMatches(){const e=[];return this.config.esports.games.callOfDuty&&e.push(...this.getCallOfDutyMatches()),this.config.esports.games.dota&&e.push(...this.getDotaMatches()),this.config.esports.games.rocketLeague&&e.push(...this.getRocketLeagueMatches()),this.config.esports.games.overwatch&&e.push(...this.getOverwatchMatches()),this.config.esports.games.leagueOfLegends&&e.push(...this.getLolMatches()),this.config.esports.games.csgo&&e.push(...this.getCsgoMatches()),this.config.esports.games.valorant&&e.push(...this.getValorantMatches()),this.config.esports.games.rainbowSixSiege&&e.push(...this.getR6Matches()),this.todayMatches=this.sortGamesByDatetime(e),this.logger(`there were found ${this.todayMatches.length} matches across all selected games`,"before"),this.todayMatches}getFavoriteTeamsMatches(e){const t=this.config.esports.favoriteTeams.map((e=>e.toLowerCase())),i=e.filter((e=>{const i=e.teams.map((e=>e.toLowerCase()));return this.config.settings.strictTeamComparasion?i.some((e=>t.includes(e.toLowerCase()))):i.some((e=>t.filter((t=>e.search(t)>-1)).length>0))}));return this.todayFavoriteTeamsMatches=this.sortGamesByDatetime(i),this.logger(`there were found ${this.todayFavoriteTeamsMatches.length} of your favorite teams in the next coulpe of days`),this.todayFavoriteTeamsMatches}generateEmailContent(e){let t="";const i="text-align: center;",s="border: 1px solid #333; white-space: nowrap;",a=`<center>\n                    <table style="border: 1px solid #333; width: 90%">\n                      <colgroup>\n                        <col span="1" style="width: 20%;">\n                        <col span="1" style="width: 60%;">\n                        <col span="1" style="width: 20%;">\n                      </colgroup>\n                      <thead>${`<tr style="${i}">\n                      <th style="${s}">Time</th>\n                      <th style="${s}">Match</th>\n                      <th style="${s}">Game</th>\n                    </tr>`}</thead>\n                      <tbody>${(()=>e.map((e=>{const t=e.teamA.image||e.teamA.countryImage||"",a=e.teamB.image||e.teamB.countryImage||"";return`<tr style="${i}">\n                            <td style="${s}">\n                              <div style="text-align: center;">${this.config.settings.notifyOnlyAboutTodayGames?`<p style="white-space: nowrap;">${e.time}</p>`:`<p style="white-space: nowrap;">${e.date}</p><p style="white-space: nowrap;">${e.time}</p>`}</div>\n                            </td>\n                            <td style="${s} padding: 10px 0;">\n                              <a href="${e.link}">\n                                <div style="display: flex; align-items: center; justify-content: center; gap: 100px;">\n                                  <div style="width: 100%;">\n                                    ${""===t?"":`<img src="${t}" width="30px" height="30px"><br>`}\n                                    <span>${e.teamA.name}</span>\n                                  </div>\n                                  <div style="width: 100%;">\n                                    ${""===a?"":`<img src="${a}" width="30px" height="30px"><br>`}\n                                    <span>${e.teamB.name}</span>\n                                  </div>\n                                  </div>\n                              </a>\n                              <br>\n                              <span style="word-wrap: break-word;">${e.event}</span>\n                            </td>\n                            <td style="${s} padding: 10px 0;">\n                              <div style="text-align: center;">\n                                <a href="${e.game.link}">\n                                  <img width="30px" height="30px" src="${e.game.image}"><br>\n                                  <span>${e.game.name}</span>\n                                </a>\n                              </div>\n                            </td>\n                          </tr>`})).join(""))()}</tbody>\n                    </table>\n                  </center>`;return t+="Hi,<br><br>\n",t+=`there ${1===e.length?"is":"are"} <b>${e.length} ${1===e.length?"game":"games"}</b> of your favorite teams ${this.config.settings.notifyOnlyAboutTodayGames?"today":"soon"}: <br><br>\n`,t+=`${a}<br>\n`,t+=`Regards, <br>your <a href="https://github.com/${this.GITHUB_REPOSITORY}#readme"><b>${this.APPNAME}</b></a> bot`,t}sendEmail(e){0!==e.length&&(this.logger(`email sent to ${this.USER_EMAIL} to inform about ${e.length} games`),MailApp.sendEmail({to:this.USER_EMAIL,subject:`${this.APPNAME} - ${e.length} ${1===e.length?"game":"games"} of your favorite teams ${this.config.settings.notifyOnlyAboutTodayGames?`today - ${this.TODAY_DATE}`:"soon"}`,htmlBody:this.generateEmailContent(e)}))}install(){this.logger(`install ${this.APPNAME}`);const e=this.config.datetime.timeToSendEmail.split(":");if(2!==e.length)throw new Error(this.ERRORS.timeToSendEmailIncorrect);const t=ScriptApp.getProjectTriggers().find((e=>e.getHandlerFunction()===this.config.settings.loopFunction));t&&(this.logger(`removed old trigger of function ${this.config.settings.loopFunction}`),ScriptApp.deleteTrigger(t)),this.logger(`the loop function ${this.config.settings.loopFunction} will be triggered everyday at ${this.config.datetime.timeToSendEmail}`),ScriptApp.newTrigger(this.config.settings.loopFunction).timeBased().everyDays(1).atHour(Number(e[0])-this.config.datetime.diffHoursFromGmtTimezone).nearMinute(Number(e[1])).create()}uninstall(){this.logger(`uninstall ${this.APPNAME}`);const e=ScriptApp.getProjectTriggers().find((e=>e.getHandlerFunction()===this.config.settings.loopFunction));e&&ScriptApp.deleteTrigger(e)}checkTodayGames(){const e=this.getAllTodayMatches(),t=this.getFavoriteTeamsMatches(e),i=t.filter((e=>e.date===this.TODAY_DATE));this.logger(`there were found ${i.length} of your favorite teams today`,"after");const s=this.config.settings.notifyOnlyAboutTodayGames?i:t;this.sendEmail(s)}}}));